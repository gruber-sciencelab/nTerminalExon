# nTerminalExon

# novel Terminal Exon

Identification of novel Terminal Exons analysis using TECtool

## Table of Contents

1. [Environment installation](#environment-installation)
2. [nTE conda environment](#nte-conda-environment)
3. [Download the required input files](#download-the-required-input-files)


## Environment installation: CONDA + MAMBA

To install the latest version of miniconda on a Linux systems please execute:

```bash
wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
source .bashrc
```
Mamba should be installed within the base environment as a requisite step.

```bash
conda install -n base -c conda-forge mamba
```

## nTE conda environment

The script file to create the conda nTE environment and the yml file with package dependencies are included. Create the environment:

```bash
bash scripts/create-conda-environment.sh
```
And activate it:

```bash
conda activate nTE
```

## Download the required input files

This analysis requires species-specific genomic sequence and annotation in FASTA and GTF formats from ENSEMBL servers. Included within this repository is a handy bash script that can assist in acquiring this data specifically for Homo sapiens:

```bash
bash scripts/download-ENSEMBL-resources.sh \
  --species hsa \
  --output-directory resources_ENSEMBL_hsa
```
A PolyA sites file is also required. The download process from [atlas] is also included:

```bash
bash scripts/download-polyA-atlas.sh \
  --species hsa \
  --output-directory ATLAS2_hsa
```

## Creation of design file

In order to start the analysis, some basic technical and biological information has to be provided. In pursuit of this, a tsv file has to be submitted.
A template file is provided.

* Avoid using special characters such as period (.), pipe (|), and whitespace in the IDs of samples and in the condition columns.
* When filling the table, remember to input the paths for the forward reads in the "fq1" column and for the reverse reads in the "fq2" column. This rule applies even for single-end sequencing data. If the reads exclusively originate from the reverse strand, please leave the "fq1" field empty.
* "adapter1" pertains to reads found in the "fq1" column, while "adapter2" pertains to reads found in the "fq2" column.
* In the "library" column, you have the option to specify either "stranded" or "unstranded".

## Create the config file

The configuration details for this Snakemake pipeline are defined within the config.yml file, encompassing input paths and parameter values. However, due to the intricate nature of the nTE workflow, which comprises distinct modules, the configuration file must be generated dynamically. This generation relies on a template configuration file named config_template.yml. It is the responsibility of the user to make manual adjustments to this template file. Once the template has been suitably customized, a pipeline configuration file can be generated by executing a Python script based on it.

```bash
python scripts/create-main-config-file.py \
  --config-template configs/config_template.yml \
  --pipeline-configfile configs/config.yml
```

## Start the analysis

### Step 1: Sample preprocessing

```bash
# copy the snake preprocessing file
cp snakefile/Snakefile_Step1_Preprocessing Snakefile
# Run the pipeline
nohup bash execution/run.sh \
  -c configs/config.yml \
  -e local \
 -n 8  \
  -t conda >& run_preprocessing.txt &
# remove the file
rm Snakefile
```

nohup bash execution/run.sh \
  -c configs/config.yml \
  -e local \
 -n 8  \
  -t conda >& run_preprocessing.txt &

### Step 2: Terminal Exon Characterization

```bash
cp snakefile/Snakefile_Step2_Terminal_exon_characterization Snakefile
# Run the pipeline
bash exection/run.sh
```



APPENDIX 1: how to download SRA samples

MAPP installation is therefore automatised and limitted to downloading the following repository (also possible with git clone command, provided Git version control system is available), navigating to the MAPP directory and running a shell script which will build the environment for the workflow. This may be achieved by the following command: bash scripts/create-conda-environment_sratoolkit.sh

Explicar un poco como funciona, dirigir a sratoolkit github etc etc

# DEMO:

### Step 1: Sample preprocessing

```bash
cp snakefile/Snakefile_Step1_Preprocessing Snakefile
# Run the pipeline
bash exection/run.sh
# rm Snakefile

```

### Step 2: Terminal Exon Characterization

```bash
cp snakefile/Snakefile_Step2_Terminal_exon_characterization Snakefile
# Run the pipeline
bash exection/run.sh
```

Muestras + creacion design file


1. Muestras + creacion design file
conda activate sratoolkit
prefetch sra bla bla bla bla

SRR9274314
SRR9274306


creacion design file

2. Descargar los archivos de referencia

3. Empezar el analisis
conda activate nTE
modificacmos el config file con los paths al design file y tambien a los archivos de referencia
creamos el config file

4. Empezamos el analisis


[atlas]: https://polyasite.unibas.ch/atlas
